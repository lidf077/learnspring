<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/304720 (zh-CN, DDL); Windows/10.0.14393 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="3229"/>
<h1>4、声明式事务-JdbcTemplate</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/6/16 14:06</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2017/6/16 16:15</i></td></tr>
<tr><td><b>作者：</b></td><td><i>雷丰阳</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div>事务：</div><div>     操作数据库；</div><div>     Spring提供了JdbcTemplate能快捷的操作数据库；</div><div>     JdbcTemplate和QueryRunner；</div><div>JdbcTemplate使用步骤：</div><div>1）、导包；</div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>spring-jdbc-4.0.0.RELEASE.jar</div><div>spring-orm-4.0.0.RELEASE.jar</div><div>spring-tx-4.0.0.RELEASE.jar</div></div><div><br/></div></div><div>2）、写配置</div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>    &lt;!--引入外部配置文件  --&gt;</div><div>    &lt;context:property-placeholder location=&quot;classpath:dbconfig.properties&quot;/&gt;</div><div><br/></div><div>    &lt;!-- 实验1：测试数据源</div><div>    ${}取出配置文件中的值</div><div>    #{}Spring的表达式语言</div><div>     --&gt;</div><div>    &lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;</div><div>        &lt;property name=&quot;user&quot; value=&quot;${jdbc.user}&quot;&gt;&lt;/property&gt;</div><div>        &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;&gt;&lt;/property&gt;</div><div>        &lt;property name=&quot;jdbcUrl&quot; value=&quot;${jdbc.jdbcUrl}&quot;&gt;&lt;/property&gt;</div><div>        &lt;property name=&quot;driverClass&quot; value=&quot;${jdbc.driverClass}&quot;&gt;&lt;/property&gt;</div><div>    &lt;/bean&gt;</div><div><br/></div><div>    &lt;!-- Spring提供了一个类JdbcTemplate，我们用它操作数据库；</div><div>        导入Spring的数据库模块</div><div>spring-jdbc-4.0.0.RELEASE.jar</div><div>spring-orm-4.0.0.RELEASE.jar</div><div>spring-tx-4.0.0.RELEASE.jar</div><div>         --&gt;</div><div>    &lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;</div><div>        &lt;constructor-arg name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/constructor-arg&gt;</div><div>    &lt;/bean&gt;</div></div><div><br/></div></div><div>3）、测试</div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>@Test</div><div>    public void test02(){</div><div>        String sql = &quot;UPDATE employee SET salary=? WHERE emp_id=?&quot;;</div><div>        int update = jdbcTemplate.update(sql, 1300.00,5);</div><div>        System.out.println(&quot;更新员工：&quot;+update);</div><div>    }</div></div><div><br/></div></div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>package com.atguigu.test;</div><div><br/></div><div>import static org.junit.Assert.*;</div><div><br/></div><div>import java.sql.Connection;</div><div>import java.sql.SQLException;</div><div>import java.util.ArrayList;</div><div>import java.util.HashMap;</div><div>import java.util.List;</div><div>import java.util.Map;</div><div><br/></div><div>import javax.sql.DataSource;</div><div><br/></div><div>import org.junit.Test;</div><div>import org.springframework.context.ApplicationContext;</div><div>import org.springframework.context.support.ClassPathXmlApplicationContext;</div><div>import org.springframework.dao.DataAccessException;</div><div>import org.springframework.jdbc.core.BeanPropertyRowMapper;</div><div>import org.springframework.jdbc.core.JdbcTemplate;</div><div>import org.springframework.jdbc.core.namedparam.BeanPropertySqlParameterSource;</div><div>import org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate;</div><div><br/></div><div>import com.atguigu.bean.Employee;</div><div>import com.atguigu.dao.EmployeeDao;</div><div><br/></div><div>public class TxTest {</div><div><br/></div><div>    ApplicationContext ioc = new ClassPathXmlApplicationContext(&quot;ApplicationContext.xml&quot;);</div><div>    JdbcTemplate jdbcTemplate = ioc.getBean(JdbcTemplate.class);</div><div>    NamedParameterJdbcTemplate namedJdbcTemplate = ioc.getBean(NamedParameterJdbcTemplate.class);</div><div><br/></div><div>    /**</div><div>     * 实验9：创建BookDao，自动装配JdbcTemplate对象</div><div>     */</div><div>    @Test</div><div>    public void test09(){</div><div>        EmployeeDao bean = ioc.getBean(EmployeeDao.class);</div><div>        Employee employee = new Employee();</div><div>        employee.setEmpName(&quot;哈哈2&quot;);</div><div>        employee.setSalary(998.98);</div><div>        bean.saveEmployee(employee);</div><div>    }</div><div><br/></div><div>    /**</div><div>     * 实验8：重复实验7，以SqlParameterSource形式传入参数值</div><div>     */</div><div>    @Test</div><div>    public void test08(){</div><div>        String sql = &quot;INSERT INTO employee(emp_name,salary) VALUES(:empName,:salary)&quot;;</div><div>        Employee employee = new Employee();</div><div>        employee.setEmpName(&quot;哈哈&quot;);</div><div>        employee.setSalary(998.98);</div><div><br/></div><div>        //</div><div>        int i = namedJdbcTemplate.update(sql, new BeanPropertySqlParameterSource(employee));</div><div>        System.out.println(i);</div><div><br/></div><div>    }</div><div><br/></div><div>    /**</div><div>     * 实验7：使用带有具名参数的SQL语句插入一条员工记录，并以Map形式传入参数值</div><div>     *</div><div>     * 具名参数：（具有名字的参数，参数不是占位符了，而是一个变量名）</div><div>     *         语法格式：   :参数名</div><div>     * Spring有一个支持具名参数功能的JdbcTemplate</div><div>     *</div><div>     * 占位符参数：?的顺序千万不能乱。传参的时候一定注意；</div><div>     */</div><div>    @Test</div><div>    public void test07(){</div><div>        String sql = &quot;INSERT INTO employee(emp_name,salary) VALUES(:empName,:salary)&quot;;</div><div><br/></div><div>        //Map</div><div>        Map&lt;String, Object&gt; paramMap = new HashMap&lt;&gt;();</div><div>        //将所有具名参数的值都放在map中；</div><div>        paramMap.put(&quot;empName&quot;, &quot;田七&quot;);</div><div>        paramMap.put(&quot;salary&quot;, 9887.98);</div><div>        int update = namedJdbcTemplate.update(sql, paramMap);</div><div>        System.out.println(update);</div><div>    }</div><div><br/></div><div>    /**</div><div>     * 实验6：查询最大salary</div><div>     */</div><div>    @Test</div><div>    public void test06(){</div><div>        String sql = &quot;select max(salary) from employee&quot;;</div><div>        //无论是返回单个数据还是单个对象，都是调用queryForObject</div><div>        Double object = jdbcTemplate.queryForObject(sql, Double.class);</div><div>        System.out.println(object);</div><div>    }</div><div><br/></div><div>    /**</div><div>     * 实验5：查询salary&gt;4000的数据库记录，封装为List集合返回</div><div>     */</div><div>    @Test</div><div>    public void test05(){</div><div>        String sql = &quot;SELECT emp_id empId,emp_name empName,salary FROM employee WHERE salary&gt;?&quot;;</div><div>        //封装List；集合里面元素的类型</div><div>        List&lt;Employee&gt; list = jdbcTemplate.query(sql, new BeanPropertyRowMapper&lt;&gt;(Employee.class), 4000);</div><div><br/></div><div>        for (Employee employee : list) {</div><div>            System.out.println(employee);</div><div>        }</div><div>    }</div><div><br/></div><div>    /**</div><div>     * 实验4：查询emp_id=5的数据库记录，封装为一个Java对象返回；</div><div>     * javaBean需要和数据库中字段名一致，否则无法完成封装；</div><div>     *</div><div>     * jdbcTemplate在方法级别进行了区分</div><div>     * 查询集合：jdbcTemplate.query()</div><div>     * 查询单个对象：jdbcTemplate.queryForObject()</div><div>     *         如果查询没结果就报错；</div><div>     *</div><div>     */</div><div>    @Test</div><div>    public void test04(){</div><div>        String sql = &quot;SELECT emp_id empId,emp_name empName,salary FROM employee WHERE emp_id=?&quot;;</div><div>        //RowMapper：每一行记录和javaBean的属性如何映射</div><div>        Employee employee = null;</div><div>        try {</div><div>            employee = jdbcTemplate.queryForObject(sql, new BeanPropertyRowMapper&lt;&gt;(Employee.class), 50);</div><div>        } catch (DataAccessException e) {</div><div><br/></div><div>        }</div><div>        System.out.println(employee);</div><div>    }</div><div><br/></div><div>    /**</div><div>     * 实验3：批量插入；</div><div>     */</div><div>    @Test</div><div>    public void test03(){</div><div>        String  sql =&quot;INSERT INTO employee(emp_name,salary) VALUES(?,?)&quot;;</div><div>        //List&lt;Object[]&gt;</div><div>        //List的长度就是sql语句要执行的次数</div><div>        //Object[]：每次执行要用的参数</div><div>        List&lt;Object[]&gt; batchArgs = new ArrayList&lt;Object[]&gt;();</div><div>        batchArgs.add(new Object[]{&quot;张三&quot;,1998.98});</div><div>        batchArgs.add(new Object[]{&quot;李四&quot;,2998.98});</div><div>        batchArgs.add(new Object[]{&quot;王五&quot;,3998.98});</div><div>        batchArgs.add(new Object[]{&quot;赵六&quot;,4998.98});</div><div><br/></div><div>        int[] is = jdbcTemplate.batchUpdate(sql, batchArgs);</div><div>        for (int i : is) {</div><div>            System.out.println(i);</div><div>        }</div><div>    }</div><div><br/></div><div>    /**</div><div>     * 实验2：将emp_id=5的记录的salary字段更新为1300.00</div><div>     */</div><div>    @Test</div><div>    public void test02(){</div><div>        String sql = &quot;UPDATE employee SET salary=? WHERE emp_id=?&quot;;</div><div>        int update = jdbcTemplate.update(sql, 1300.00,5);</div><div>        System.out.println(&quot;更新员工：&quot;+update);</div><div>    }</div><div><br/></div><div>    @Test</div><div>    public void test() throws SQLException {</div><div>        DataSource bean = ioc.getBean(DataSource.class);</div><div>        Connection connection = bean.getConnection();</div><div>        System.out.println(connection);</div><div>        connection.close();</div><div><br/></div><div>    }</div><div><br/></div><div>    @Test</div><div>    public void test01() throws SQLException {</div><div>        System.out.println(jdbcTemplate);</div><div>    }</div><div><br/></div><div>}</div></div><div><br/></div><div><br/></div><div><hr/></div><div><br/></div><div><br/></div></span>
</div></body></html> 