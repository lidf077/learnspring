<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/304720 (zh-CN, DDL); Windows/10.0.14393 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="3415"/>
<h1>6、缓存机制</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/6/28 9:04</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2017/6/28 11:01</i></td></tr>
<tr><td><b>作者：</b></td><td><i>雷丰阳</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div>缓存：暂时的存储一些数据；加快系统的查询速度...</div><div>CPU：</div><div>     主频：4-2.7GHZ  </div><div>     内存：4G-8G    1333MHZ    2166MHZ</div><div>     CPU：一级缓存（4MB）；二级缓存 （16MB）;</div><div><br/></div><div>数据库交互；</div><div>    Employee employee =  employDao.getEmpById(1);</div><div>MyBatis缓存机制：Map；能保存查询出的一些数据；</div><div>一级缓存：线程级别的缓存；本地缓存；SqlSession级别的缓存；</div><div>二级缓存：全局范围的缓存；除过当前线程；SqlSession能用外其他也可以使用；</div><div><hr/></div><div>一级缓存：MyBatis：SqlSesion级别的缓存；默认存在；</div><div>机制：只要之前查询过的数据，mybatis就会保存在一个缓存中（Map）；下次获取直接从缓存中拿；</div><div><br/></div><div>一级缓存失效的几种情况：</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>- 1、不同的SqlSession对应不同的一级缓存</div><div>- 2、同一个SqlSession但是查询条件不同</div><div>- 3、同一个SqlSession两次查询期间执行了任何一次增删改操作</div><div>- 4、同一个SqlSession两次查询期间手动清空了缓存</div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>一级缓存：</div><div><img src="6、缓存机制_files/Image.png" type="image/png" style="height: auto;"/></div><div>key好长；</div><div><br/></div><div><hr/></div><div>二级缓存：namespace级别的缓存；</div><div>一级缓存；SqlSession关闭或者提交以后，一级缓存的数据会放在二级缓存中；</div><div>mybatis默认没有使用的；配置；</div><div>二级缓存的使用：</div><div>1、全局配置开启二级缓存</div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;!-- 开启全局缓存开关； --&gt;</div><div>        &lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot;/&gt;</div></div><div>2、配置某个dao.xml文件，让其使用二级缓存</div><div align="left" style="min-height: 18pt;"><div><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt; background:#d4d4d4">cache</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">&gt;&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt; background:#d4d4d4">cache</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">&gt;</span></font></div><div><hr/></div><div><font color="#008080" face="Consolas"><span style="font-size: 21.14285659790039px;">缓存原理</span></font></div><div><img src="6、缓存机制_files/Image [1].png" type="image/png"/></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(232, 242, 254);"><span style="color: rgb(0, 128, 128);"><br/></span></span></span></span></div><div><hr/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>- 1、全局setting的cacheEnable：</div><div>- 配置二级缓存的开关。一级缓存一直是打开的。</div><div>- 2、select标签的useCache属性：</div><div>- 配置这个select是否使用二级缓存。一级缓存一直是使用的</div><div>- 3、sql标签的flushCache属性：</div><div>- 增删改默认flushCache=true。sql执行以后，会同时清空一级和二级缓存。查询默认flushCache=false。</div><div>- 4、sqlSession.clearCache()：</div><div>- 只是用来清除一级缓存。</div><div>- 5、当在某一个作用域 (一级缓存Session/二级缓存Namespaces) 进行了 C/U/D 操作后，默认该作用域下所有 select 中的缓存将被clear。</div></div><div><br/></div><div><hr/></div><div>整合第三方缓存；</div><div>MyBatis；---Cache；</div><div>整合ehcache；ehcache非常专业的java进程内的缓存框架；</div><div>1、导包</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>ehcache-core-2.6.8.jar(ehcache核心包)</div><div>mybatis-ehcache-1.0.3.jar(ehcache的整合包) </div><div>slf4j-api-1.7.21.jar</div><div>slf4j-log4j12-1.7.21.jar</div></div><div>2、ehcache要工作有一个配置文件；</div><div>     文件名叫ehcache.xml；放在类路径的根目录下</div><div>3、在mapper.xml中配置使用自定义的缓存</div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;cache type=&quot;org.mybatis.caches.ehcache.EhcacheCache&quot;&gt;&lt;/cache&gt;</div></div><div>4、别的dao还要用这个缓存；</div><div><br/></div><div>缓存引用cache-ref</div><div align="left" style="min-height: 18pt;"><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;!--  和别的dao共用一块缓存--&gt;</div><div>    &lt;cache-ref namespace=&quot;com.atguigu.dao.TeacherDao&quot;/&gt;</div></div><div><br/></div></div></div><div><br/></div></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>     </div><div>     </div><div><br/></div></span>
</div></body></html> 